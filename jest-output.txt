
> chat-engine-tax-filing@1.0.0 test
> jest --runInBand --verbose --detectOpenHandles

[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:00:30"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:00:30"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:01:31"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{"metadata":{"filingStatus":"single","taxYear":2023},"title":"Tax Filing Help"},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:01:31","url":"/api/conversations"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "POST /api/conversations HTTP/1.1" 400 466 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{"title":"Test"},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:01:31","url":"/api/conversations"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "POST /api/conversations HTTP/1.1" 400 466 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "POST /api/conversations HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:01:31","url":"/api/conversations"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "POST /api/conversations HTTP/1.1" 400 466 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "GET /api/conversations/test-conversation-1759716181553-2cx33761t HTTP/1.1" 200 971 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "GET /api/conversations/test-conversation-1759716181639-4debbash0 HTTP/1.1" 200 971 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:113:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:01:31","url":"/api/conversations/test-conversation-1759716181715-ot28s6fcx"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "GET /api/conversations/test-conversation-1759716181715-ot28s6fcx HTTP/1.1" 400 183 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "GET /api/conversations/test-conversation-1759716181794-52qncktma HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[33m[33mwarn[33m[39m: [33mClient error: Conversation not found[39m {"body":{},"clientId":"test-client-123","code":"CONVERSATION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Conversation not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:119:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:01:31","url":"/api/conversations/507f1f77bcf86cd799439011"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:01 +0000] "GET /api/conversations/507f1f77bcf86cd799439011 HTTP/1.1" 404 176 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:01:31"}
[32m[32minfo[32m[39m: [32mAdding message to conversation[39m {"conversationId":"test-conversation-1759716181946-eff77yrgm","messageLength":34,"role":"user","sessionId":"test-session-1759716181938-6jt97a91h","timestamp":"2025-10-06 10:03:01:31"}
[31m[31merror[31m[39m: [31mFailed to add message to conversation[39m {"conversationId":"test-conversation-1759716181946-eff77yrgm","error":{"_message":"Conversation validation failed","errors":{"context.extractedData":{"kind":"Map","message":"Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235532d842707b8c6e80'),\n    conversationId: 'test-conversation-1759716181946-eff77yrgm',\n    sessionId: 'test-session-1759716181938-6jt97a91h',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:01.946Z,\n    updatedAt: 2025-10-06T02:03:02.009Z,\n    lastMessageAt: 2025-10-06T02:03:02.009Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"CastError","path":"context.extractedData","reason":{},"stringValue":"\"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235532d842707b8c6e80'),\n    conversationId: 'test-conversation-1759716181946-eff77yrgm',\n    sessionId: 'test-session-1759716181938-6jt97a91h',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:01.946Z,\n    updatedAt: 2025-10-06T02:03:02.009Z,\n    lastMessageAt: 2025-10-06T02:03:02.009Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\"","value":{"$__parent":{"_id":"68e3235532d842707b8c6e80","context":{"conversationState":"greeting","currentTopic":"deductions","extractedData":{},"flags":{"hasErrors":false,"isComplete":false,"requiresHumanReview":false},"pendingActions":[{"_id":"68e3235632d842707b8c6e8a","action":"Consider reviewing your income sources","priority":1},{"_id":"68e3235632d842707b8c6e8b","action":"Check if you qualify for any deductions","priority":1}],"userIntent":"general_inquiry"},"conversationId":"test-conversation-1759716181946-eff77yrgm","createdAt":"2025-10-06T02:03:01.946Z","lastMessageAt":"2025-10-06T02:03:02.015Z","messages":[{"content":"I need help filing my taxes","messageId":"msg-1","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:01.946Z"},{"content":"I'd be happy to help you with your tax filing. Let's start by gathering some basic information.","messageId":"msg-2","metadata":{"attachments":[],"entities":[]},"role":"assistant","timestamp":"2025-10-06T02:03:01.946Z"},{"content":"I need help with my tax deductions","messageId":"mgehkvzt_1a8a25d30572636c","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:02.009Z"},{"content":"Mock AI response to: I need help with my tax deductions","messageId":"mgehkvzy_9ef998587f0fb782","metadata":{"attachments":[],"confidence":0.7,"entities":[],"intent":"general_inquiry","model":"gpt-4"},"role":"assistant","timestamp":"2025-10-06T02:03:02.015Z"}],"sessionId":"test-session-1759716181938-6jt97a91h","status":"active","summary":"User seeking help with tax filing","title":"Tax Filing Conversation","updatedAt":"2025-10-06T02:03:02.016Z"},"$__path":"context.extractedData","$__schemaType":{"_index":null,"_presplitPath":["context","extractedData","$*"],"getters":[],"instance":"Mixed","options":{},"path":"context.extractedData.$*","schemaName":"Mixed","setters":[],"validators":[]},"form":"1040"},"valueType":"Object"}},"message":"Conversation validation failed: context.extractedData: Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235532d842707b8c6e80'),\n    conversationId: 'test-conversation-1759716181946-eff77yrgm',\n    sessionId: 'test-session-1759716181938-6jt97a91h',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:01.946Z,\n    updatedAt: 2025-10-06T02:03:02.009Z,\n    lastMessageAt: 2025-10-06T02:03:02.009Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"ValidationError"},"role":"user","timestamp":"2025-10-06 10:03:02:32"}
[31m[31merror[31m[39m: [31mServer error: Conversation validation failed: context.extractedData: Cast to Map failed for value "{[39m
[31m  '$__parent': {[39m
[31m    context: {[39m
[31m      flags: [Object],[39m
[31m      currentTopic: 'tax_filing',[39m
[31m      extractedData: Map(0) {},[39m
[31m      userIntent: 'general_inquiry',[39m
[31m      conversationState: 'data_collection',[39m
[31m      pendingActions: [][39m
[31m    },[39m
[31m    _id: new ObjectId('68e3235532d842707b8c6e80'),[39m
[31m    conversationId: 'test-conversation-1759716181946-eff77yrgm',[39m
[31m    sessionId: 'test-session-1759716181938-6jt97a91h',[39m
[31m    title: 'Tax Filing Conversation',[39m
[31m    messages: [ [Object], [Object], [Object] ],[39m
[31m    summary: 'User seeking help with tax filing',[39m
[31m    status: 'active',[39m
[31m    createdAt: 2025-10-06T02:03:01.946Z,[39m
[31m    updatedAt: 2025-10-06T02:03:02.009Z,[39m
[31m    lastMessageAt: 2025-10-06T02:03:02.009Z[39m
[31m  },[39m
[31m  '$__path': 'context.extractedData',[39m
[31m  '$__schemaType': SchemaMixed {[39m
[31m    path: 'context.extractedData.$*',[39m
[31m    instance: 'Mixed',[39m
[31m    schemaName: 'Mixed',[39m
[31m    validators: [],[39m
[31m    getters: [],[39m
[31m    setters: [],[39m
[31m    _presplitPath: [ 'context', 'extractedData', '$*' ],[39m
[31m    options: SchemaTypeOptions { type: [Function] },[39m
[31m    _index: null,[39m
[31m    [Symbol(mongoose#schemaType)]: true,[39m
[31m    [Symbol(mongoose:schema_mixed)]: true[39m
[31m  },[39m
[31m  form: '1040'[39m
[31m}" (type Object) at path "context.extractedData"[39m {"body":{"content":"I need help with my tax deductions","role":"user"},"clientId":"test-client-123","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"ValidationError: Conversation validation failed: context.extractedData: Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235532d842707b8c6e80'),\n    conversationId: 'test-conversation-1759716181946-eff77yrgm',\n    sessionId: 'test-session-1759716181938-6jt97a91h',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:01.946Z,\n    updatedAt: 2025-10-06T02:03:02.009Z,\n    lastMessageAt: 2025-10-06T02:03:02.009Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"\n    at model.Object.<anonymous>.Document.invalidate (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\document.js:3362:32)\n    at model.$set (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\document.js:1490:12)\n    at Document.set [as extractedData] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\helpers\\document\\compile.js:205:19)\n    at ConversationService.generateAIResponse (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\services\\conversationService.ts:193:41)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at ConversationService.addMessage (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\services\\conversationService.ts:146:22)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:385:20","timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations/test-conversation-1759716181946-eff77yrgm/messages"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716181946-eff77yrgm/messages HTTP/1.1" 500 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32mAdding message to conversation[39m {"conversationId":"test-conversation-1759716182094-9emgi4q85","messageLength":25,"role":"user","sessionId":"test-session-1759716182087-tmy7h06ba","timestamp":"2025-10-06 10:03:02:32"}
[31m[31merror[31m[39m: [31mFailed to add message to conversation[39m {"conversationId":"test-conversation-1759716182094-9emgi4q85","error":{"_message":"Conversation validation failed","errors":{"context.extractedData":{"kind":"Map","message":"Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6e98'),\n    conversationId: 'test-conversation-1759716182094-9emgi4q85',\n    sessionId: 'test-session-1759716182087-tmy7h06ba',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.094Z,\n    updatedAt: 2025-10-06T02:03:02.151Z,\n    lastMessageAt: 2025-10-06T02:03:02.150Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"CastError","path":"context.extractedData","reason":{},"stringValue":"\"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6e98'),\n    conversationId: 'test-conversation-1759716182094-9emgi4q85',\n    sessionId: 'test-session-1759716182087-tmy7h06ba',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.094Z,\n    updatedAt: 2025-10-06T02:03:02.151Z,\n    lastMessageAt: 2025-10-06T02:03:02.150Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\"","value":{"$__parent":{"_id":"68e3235632d842707b8c6e98","context":{"conversationState":"greeting","currentTopic":"general_inquiry","extractedData":{},"flags":{"hasErrors":false,"isComplete":false,"requiresHumanReview":false},"pendingActions":[{"_id":"68e3235632d842707b8c6ea2","action":"Consider reviewing your income sources","priority":1},{"_id":"68e3235632d842707b8c6ea3","action":"Check if you qualify for any deductions","priority":1}],"userIntent":"general_inquiry"},"conversationId":"test-conversation-1759716182094-9emgi4q85","createdAt":"2025-10-06T02:03:02.094Z","lastMessageAt":"2025-10-06T02:03:02.152Z","messages":[{"content":"I need help filing my taxes","messageId":"msg-1","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:02.094Z"},{"content":"I'd be happy to help you with your tax filing. Let's start by gathering some basic information.","messageId":"msg-2","metadata":{"attachments":[],"entities":[]},"role":"assistant","timestamp":"2025-10-06T02:03:02.094Z"},{"content":"What tax forms do I need?","messageId":"mgehkw3q_93c34ec85083ccb4","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:02.150Z"},{"content":"Mock AI response to: What tax forms do I need?","messageId":"mgehkw3s_5f0c3450ed34413e","metadata":{"attachments":[],"confidence":0.7,"entities":[],"intent":"general_inquiry","model":"gpt-4"},"role":"assistant","timestamp":"2025-10-06T02:03:02.152Z"}],"sessionId":"test-session-1759716182087-tmy7h06ba","status":"active","summary":"User seeking help with tax filing","title":"Tax Filing Conversation","updatedAt":"2025-10-06T02:03:02.152Z"},"$__path":"context.extractedData","$__schemaType":{"_index":null,"_presplitPath":["context","extractedData","$*"],"getters":[],"instance":"Mixed","options":{},"path":"context.extractedData.$*","schemaName":"Mixed","setters":[],"validators":[]},"form":"1040"},"valueType":"Object"}},"message":"Conversation validation failed: context.extractedData: Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6e98'),\n    conversationId: 'test-conversation-1759716182094-9emgi4q85',\n    sessionId: 'test-session-1759716182087-tmy7h06ba',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.094Z,\n    updatedAt: 2025-10-06T02:03:02.151Z,\n    lastMessageAt: 2025-10-06T02:03:02.150Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"ValidationError"},"role":"user","timestamp":"2025-10-06 10:03:02:32"}
[31m[31merror[31m[39m: [31mServer error: Conversation validation failed: context.extractedData: Cast to Map failed for value "{[39m
[31m  '$__parent': {[39m
[31m    context: {[39m
[31m      flags: [Object],[39m
[31m      currentTopic: 'tax_filing',[39m
[31m      extractedData: Map(0) {},[39m
[31m      userIntent: 'general_inquiry',[39m
[31m      conversationState: 'data_collection',[39m
[31m      pendingActions: [][39m
[31m    },[39m
[31m    _id: new ObjectId('68e3235632d842707b8c6e98'),[39m
[31m    conversationId: 'test-conversation-1759716182094-9emgi4q85',[39m
[31m    sessionId: 'test-session-1759716182087-tmy7h06ba',[39m
[31m    title: 'Tax Filing Conversation',[39m
[31m    messages: [ [Object], [Object], [Object] ],[39m
[31m    summary: 'User seeking help with tax filing',[39m
[31m    status: 'active',[39m
[31m    createdAt: 2025-10-06T02:03:02.094Z,[39m
[31m    updatedAt: 2025-10-06T02:03:02.151Z,[39m
[31m    lastMessageAt: 2025-10-06T02:03:02.150Z[39m
[31m  },[39m
[31m  '$__path': 'context.extractedData',[39m
[31m  '$__schemaType': SchemaMixed {[39m
[31m    path: 'context.extractedData.$*',[39m
[31m    instance: 'Mixed',[39m
[31m    schemaName: 'Mixed',[39m
[31m    validators: [],[39m
[31m    getters: [],[39m
[31m    setters: [],[39m
[31m    _presplitPath: [ 'context', 'extractedData', '$*' ],[39m
[31m    options: SchemaTypeOptions { type: [Function] },[39m
[31m    _index: null,[39m
[31m    [Symbol(mongoose#schemaType)]: true,[39m
[31m    [Symbol(mongoose:schema_mixed)]: true[39m
[31m  },[39m
[31m  form: '1040'[39m
[31m}" (type Object) at path "context.extractedData"[39m {"body":{"content":"What tax forms do I need?","role":"user"},"clientId":"test-client-123","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"ValidationError: Conversation validation failed: context.extractedData: Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'tax_filing',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6e98'),\n    conversationId: 'test-conversation-1759716182094-9emgi4q85',\n    sessionId: 'test-session-1759716182087-tmy7h06ba',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.094Z,\n    updatedAt: 2025-10-06T02:03:02.151Z,\n    lastMessageAt: 2025-10-06T02:03:02.150Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"\n    at model.Object.<anonymous>.Document.invalidate (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\document.js:3362:32)\n    at model.$set (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\document.js:1490:12)\n    at Document.set [as extractedData] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\mongoose\\lib\\helpers\\document\\compile.js:205:19)\n    at ConversationService.generateAIResponse (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\services\\conversationService.ts:193:41)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at ConversationService.addMessage (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\services\\conversationService.ts:146:22)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:385:20","timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations/test-conversation-1759716182094-9emgi4q85/messages"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182094-9emgi4q85/messages HTTP/1.1" 500 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations/test-conversation-1759716182209-f6a7b99eg/messages"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182209-f6a7b99eg/messages HTTP/1.1" 400 409 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182275-qs0jj2v2t/messages HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{"role":"user"},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations/test-conversation-1759716182334-kihd969t7/messages"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182334-kihd969t7/messages HTTP/1.1" 400 409 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32mAdding message with streaming response[39m {"conversationId":"test-conversation-1759716182409-rmn00tpho","messageLength":26,"role":"user","sessionId":"test-session-1759716182401-oege1vkpk","timestamp":"2025-10-06 10:03:02:32"}
[31m[31merror[31m[39m: [31mFailed to add message to conversation[39m {"conversationId":"test-conversation-1759716182409-rmn00tpho","error":{"_message":"Conversation validation failed","errors":{"context.extractedData":{"kind":"Map","message":"Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'general_inquiry',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6ee4'),\n    conversationId: 'test-conversation-1759716182409-rmn00tpho',\n    sessionId: 'test-session-1759716182401-oege1vkpk',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.409Z,\n    updatedAt: 2025-10-06T02:03:02.456Z,\n    lastMessageAt: 2025-10-06T02:03:02.456Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"CastError","path":"context.extractedData","reason":{},"stringValue":"\"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'general_inquiry',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6ee4'),\n    conversationId: 'test-conversation-1759716182409-rmn00tpho',\n    sessionId: 'test-session-1759716182401-oege1vkpk',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.409Z,\n    updatedAt: 2025-10-06T02:03:02.456Z,\n    lastMessageAt: 2025-10-06T02:03:02.456Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\"","value":{"$__parent":{"_id":"68e3235632d842707b8c6ee4","context":{"conversationState":"greeting","currentTopic":"general_inquiry","extractedData":{},"flags":{"hasErrors":false,"isComplete":false,"requiresHumanReview":false},"pendingActions":[{"_id":"68e3235632d842707b8c6eee","action":"Consider reviewing your income sources","priority":1},{"_id":"68e3235632d842707b8c6eef","action":"Check if you qualify for any deductions","priority":1}],"userIntent":"general_inquiry"},"conversationId":"test-conversation-1759716182409-rmn00tpho","createdAt":"2025-10-06T02:03:02.409Z","lastMessageAt":"2025-10-06T02:03:02.456Z","messages":[{"content":"I need help filing my taxes","messageId":"msg-1","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:02.409Z"},{"content":"I'd be happy to help you with your tax filing. Let's start by gathering some basic information.","messageId":"msg-2","metadata":{"attachments":[],"entities":[]},"role":"assistant","timestamp":"2025-10-06T02:03:02.409Z"},{"content":"Explain tax brackets to me","messageId":"mgehkwc8_3ac275b42d97bf0e","metadata":{"attachments":[],"entities":[]},"role":"user","timestamp":"2025-10-06T02:03:02.456Z"}],"sessionId":"test-session-1759716182401-oege1vkpk","status":"active","summary":"User seeking help with tax filing","title":"Tax Filing Conversation","updatedAt":"2025-10-06T02:03:02.456Z"},"$__path":"context.extractedData","$__schemaType":{"_index":null,"_presplitPath":["context","extractedData","$*"],"getters":[],"instance":"Mixed","options":{},"path":"context.extractedData.$*","schemaName":"Mixed","setters":[],"validators":[]},"form":"1040"},"valueType":"Object"}},"message":"Conversation validation failed: context.extractedData: Cast to Map failed for value \"{\n  '$__parent': {\n    context: {\n      flags: [Object],\n      currentTopic: 'general_inquiry',\n      extractedData: Map(0) {},\n      userIntent: 'general_inquiry',\n      conversationState: 'data_collection',\n      pendingActions: []\n    },\n    _id: new ObjectId('68e3235632d842707b8c6ee4'),\n    conversationId: 'test-conversation-1759716182409-rmn00tpho',\n    sessionId: 'test-session-1759716182401-oege1vkpk',\n    title: 'Tax Filing Conversation',\n    messages: [ [Object], [Object], [Object] ],\n    summary: 'User seeking help with tax filing',\n    status: 'active',\n    createdAt: 2025-10-06T02:03:02.409Z,\n    updatedAt: 2025-10-06T02:03:02.456Z,\n    lastMessageAt: 2025-10-06T02:03:02.456Z\n  },\n  '$__path': 'context.extractedData',\n  '$__schemaType': SchemaMixed {\n    path: 'context.extractedData.$*',\n    instance: 'Mixed',\n    schemaName: 'Mixed',\n    validators: [],\n    getters: [],\n    setters: [],\n    _presplitPath: [ 'context', 'extractedData', '$*' ],\n    options: SchemaTypeOptions { type: [Function] },\n    _index: null,\n    [Symbol(mongoose#schemaType)]: true,\n    [Symbol(mongoose:schema_mixed)]: true\n  },\n  form: '1040'\n}\" (type Object) at path \"context.extractedData\"","name":"ValidationError"},"role":"user","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182409-rmn00tpho/messages/stream HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations/test-conversation-1759716182506-a1rtu5h6c/messages/stream"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182506-a1rtu5h6c/messages/stream HTTP/1.1" 400 416 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "POST /api/conversations/test-conversation-1759716182572-jw3h4a3q8/messages/stream HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "GET /api/conversations HTTP/1.1" 200 670 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "GET /api/conversations?page=1&limit=1 HTTP/1.1" 200 373 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:63:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:02:32","url":"/api/conversations"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "GET /api/conversations HTTP/1.1" 400 141 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:02 +0000] "GET /api/conversations HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:02:32"}
[32m[32minfo[32m[39m: [32mUpdating conversation[39m {"conversationId":"test-conversation-1759716182940-0cwl49rrr","sessionId":"test-session-1759716182932-xlb83ujug","timestamp":"2025-10-06 10:03:02:32","title":"Updated Tax Conversation"}
[32m[32minfo[32m[39m: [32mConversation updated[39m {"conversationId":"test-conversation-1759716182940-0cwl49rrr","timestamp":"2025-10-06 10:03:03:33","updateData":{"metadata":{"filingStatus":"married","taxYear":2024},"title":"Updated Tax Conversation"}}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "PUT /api/conversations/test-conversation-1759716182940-0cwl49rrr HTTP/1.1" 200 205 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mUpdating conversation[39m {"conversationId":"test-conversation-1759716183038-jujvx6lh9","sessionId":"invalid-session-id","timestamp":"2025-10-06 10:03:03:33"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"PUT","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:167:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:03:33","url":"/api/conversations/test-conversation-1759716183038-jujvx6lh9"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "PUT /api/conversations/test-conversation-1759716183038-jujvx6lh9 HTTP/1.1" 400 183 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "PUT /api/conversations/test-conversation-1759716183116-9si6ufo0f HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mDeleting conversation[39m {"conversationId":"test-conversation-1759716183167-8tcxoxzzg","sessionId":"test-session-1759716183163-rv2nq3xga","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mConversation deleted[39m {"conversationId":"test-conversation-1759716183167-8tcxoxzzg","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "DELETE /api/conversations/test-conversation-1759716183167-8tcxoxzzg HTTP/1.1" 200 109 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mDeleting conversation[39m {"conversationId":"test-conversation-1759716183274-xpp66k390","sessionId":"invalid-session-id","timestamp":"2025-10-06 10:03:03:33"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"DELETE","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\conversationController.ts:209:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:03:33","url":"/api/conversations/test-conversation-1759716183274-xpp66k390"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "DELETE /api/conversations/test-conversation-1759716183274-xpp66k390 HTTP/1.1" 400 186 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "DELETE /api/conversations/test-conversation-1759716183347-1en9qpb0a HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "GET /api/conversations/stats HTTP/1.1" 200 139 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "GET /api/conversations/stats HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:03 +0000] "GET /api/conversations/health HTTP/1.1" 200 209 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:03:33"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:04:34"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716184821","timestamp":"2025-10-06 10:03:04:34"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716184821","timestamp":"2025-10-06 10:03:07:37"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:07 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:07:37"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716187867","timestamp":"2025-10-06 10:03:07:37"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716187867","timestamp":"2025-10-06 10:03:10:310"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:10 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:10:310"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716190924","timestamp":"2025-10-06 10:03:10:310"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716190924","timestamp":"2025-10-06 10:03:13:313"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:13 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:13:313"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:13 +0000] "GET /api/sse/events HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:13:313"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194114","timestamp":"2025-10-06 10:03:14:314"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194120","timestamp":"2025-10-06 10:03:14:314"}
[32m[32minfo[32m[39m: [32mSSE connection established[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194125","timestamp":"2025-10-06 10:03:14:314"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194120","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194114","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mSSE connection closed[39m {"clientId":"test-client-123","connectionId":"test-client-123_1759716194125","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/events HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mSSE broadcast sent[39m {"clientId":"test-client-123","event":"test_event","sentCount":0,"timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/broadcast HTTP/1.1" 200 95 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[33m[33mwarn[33m[39m: [33mClient error: Event type is required and must be a non-empty string[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Event type is required and must be a non-empty string\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\sseController.ts:374:13\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:124:21\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:21:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at authenticateApiKey (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\auth.ts:125:5)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:16:316","url":"/api/sse/broadcast"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/broadcast HTTP/1.1" 400 175 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/broadcast HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[33m[33mwarn[33m[39m: [33mClient error: Event type is required and must be a non-empty string[39m {"body":{"data":{"message":"test"},"event":""},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Event type is required and must be a non-empty string\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\sseController.ts:374:13\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:124:21\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:21:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at authenticateApiKey (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\auth.ts:125:5)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:16:316","url":"/api/sse/broadcast"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/broadcast HTTP/1.1" 400 175 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"session_message","sentCount":0,"sessionId":"test-session-1759716196417-jkklvfxaw","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/send/test-session-1759716196417-jkklvfxaw HTTP/1.1" 200 196 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{"data":{"message":"test"},"event":"test_event"},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:16:316","url":"/api/sse/send/invalid-session-id"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/send/invalid-session-id HTTP/1.1" 400 287 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/send/test-session-1759716196560-dqjvgllil HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"test_event","sentCount":0,"sessionId":"non-existent-session-123","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "POST /api/sse/send/non-existent-session-123 HTTP/1.1" 200 167 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/connections HTTP/1.1" 200 124 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/connections HTTP/1.1" 200 124 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "GET /api/sse/connections HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32mClosed SSE connections for session[39m {"clientId":"test-client-123","closedCount":0,"sessionId":"test-session-1759716196905-334uw5vcp","timestamp":"2025-10-06 10:03:16:316"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:16 +0000] "DELETE /api/sse/connections/test-session-1759716196905-334uw5vcp HTTP/1.1" 200 165 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:16:316"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"DELETE","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:17:317","url":"/api/sse/connections/invalid-session-id"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "DELETE /api/sse/connections/invalid-session-id HTTP/1.1" 400 296 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "DELETE /api/sse/connections/test-session-1759716197063-asdc1bja2 HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mClosed SSE connections for session[39m {"clientId":"test-client-123","closedCount":0,"sessionId":"non-existent-session-123","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "DELETE /api/sse/connections/non-existent-session-123 HTTP/1.1" 200 141 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"job_status","sentCount":0,"sessionId":"test-session-1759716197188-ameowtf0g","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "POST /api/sse/send/test-session-1759716197188-ameowtf0g HTTP/1.1" 200 191 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"document_processed","sentCount":0,"sessionId":"test-session-1759716197263-7sq8l7rhy","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "POST /api/sse/send/test-session-1759716197263-7sq8l7rhy HTTP/1.1" 200 199 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"message_received","sentCount":0,"sessionId":"test-session-1759716197337-9p6wz0vfo","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "POST /api/sse/send/test-session-1759716197337-9p6wz0vfo HTTP/1.1" 200 197 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE session event sent[39m {"clientId":"test-client-123","event":"error","sentCount":0,"sessionId":"test-session-1759716197410-wjnkt267a","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "POST /api/sse/send/test-session-1759716197410-wjnkt267a HTTP/1.1" 200 186 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "GET /api/sse/health HTTP/1.1" 200 232 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:17 +0000] "GET /api/sse/health HTTP/1.1" 200 232 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:17:317"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:18:318"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mDocument uploaded[39m {"documentId":"mgehl91v_3123b00e77b1a5eb","filename":"test-w2.pdf","sessionId":"test-session-1759716198839-4yvhrzrm8","size":16,"timestamp":"2025-10-06 10:03:18:318","type":"W2"}
[32m[32minfo[32m[39m: [32mDocument uploaded via API[39m {"clientId":"test-client-123","documentId":"mgehl91v_3123b00e77b1a5eb","filename":"test-w2.pdf","sessionId":"test-session-1759716198839-4yvhrzrm8","timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:18 +0000] "POST /api/documents/upload/test-session-1759716198839-4yvhrzrm8 HTTP/1.1" 201 522 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:18:318"}
[33m[33mwarn[33m[39m: [33mPDF text extraction not implemented[39m {"filePath":"C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\uploads\\mgehl91v_3123b00e77b1a5eb.pdf","timestamp":"2025-10-06 10:03:18:318"}
[32m[32minfo[32m[39m: [32mDocument processed successfully[39m {"confidence":0,"documentId":"mgehl91v_3123b00e77b1a5eb","entitiesCount":0,"textLength":0,"timestamp":"2025-10-06 10:03:18:318"}
[33m[33mwarn[33m[39m: [33mClient error: File type not allowed[39m {"body":{"documentType":"W2"},"clientId":"test-client-123","code":"INVALID_FILE_TYPE","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: File type not allowed\n    at fileFilter (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\upload.ts:18:8)\n    at wrappedFileFilter (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\index.js:44:7)\n    at Multipart.<anonymous> (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:109:7)\n    at Multipart.emit (node:events:518:28)\n    at HeaderParser.cb (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\busboy\\lib\\types\\multipart.js:358:14)\n    at HeaderParser.push (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\busboy\\lib\\types\\multipart.js:162:20)\n    at SBMH.ssCb [as _cb] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\busboy\\lib\\types\\multipart.js:394:37)\n    at feed (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\streamsearch\\lib\\sbmh.js:219:14)\n    at SBMH.push (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\streamsearch\\lib\\sbmh.js:104:16)\n    at Multipart._write (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\busboy\\lib\\types\\multipart.js:567:19)\n    at writeOrBuffer (node:internal/streams/writable:572:12)\n    at _write (node:internal/streams/writable:501:10)\n    at Multipart.Writable.write (node:internal/streams/writable:510:10)\n    at IncomingMessage.ondata (node:internal/streams/readable:1009:22)\n    at IncomingMessage.emit (node:events:518:28)\n    at IncomingMessage.Readable.read (node:internal/streams/readable:782:10)\n    at flow (node:internal/streams/readable:1283:53)\n    at resume_ (node:internal/streams/readable:1262:3)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","statusCode":400,"timestamp":"2025-10-06 10:03:19:319","url":"/api/documents/upload/test-session-1759716199015-fa6arsyci"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/test-session-1759716199015-fa6arsyci HTTP/1.1" 400 391 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[33m[33mwarn[33m[39m: [33mClient error: File size exceeds maximum allowed limit[39m {"body":{"documentType":"W2"},"clientId":"test-client-123","code":"FILE_TOO_LARGE","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: File size exceeds maximum allowed limit\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\routes\\documentRoutes.ts:33:23\n    at done (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:47:7)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:67:11\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\remove-uploaded-files.js:20:9\n    at MemoryStorage._removeFile (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\storage\\memory.js:16:3)\n    at remove (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:60:19)\n    at handleFile (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\remove-uploaded-files.js:10:5)\n    at removeUploadedFiles (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\remove-uploaded-files.js:25:3)\n    at Counter.<anonymous> (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:63:9)\n    at Object.onceWrapper (node:events:632:28)\n    at Counter.emit (node:events:518:28)\n    at Counter.decrement (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\counter.js:15:32)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\lib\\make-middleware.js:143:34\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\multer\\storage\\memory.js:7:5\n    at ConcatStream.<anonymous> (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\concat-stream\\index.js:37:43)\n    at ConcatStream.emit (node:events:530:35)\n    at finishMaybe (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\readable-stream\\lib\\_stream_writable.js:630:14)\n    at endWritable (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\readable-stream\\lib\\_stream_writable.js:638:3)\n    at ConcatStream.Object.<anonymous>.Writable.end (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\readable-stream\\lib\\_stream_writable.js:594:22)\n    at FileStream.onend (node:internal/streams/readable:948:10)\n    at Object.onceWrapper (node:events:632:28)\n    at FileStream.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at processTicksAndRejections (node:internal/process/task_queues:90:21)","statusCode":413,"timestamp":"2025-10-06 10:03:19:319","url":"/api/documents/upload/test-session-1759716199130-xj8z519xl"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/test-session-1759716199130-xj8z519xl HTTP/1.1" 413 201 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[31m[31merror[31m[39m: [31mFailed to upload document[39m {"error":{"code":"SESSION_NOT_FOUND","name":"CustomApiError","statusCode":400},"sessionId":"invalid-session","timestamp":"2025-10-06 10:03:19:319"}
[31m[31merror[31m[39m: [31mFailed to upload document via API[39m {"clientId":"test-client-123","error":{"code":"SESSION_NOT_FOUND","name":"CustomApiError","statusCode":400},"sessionId":"invalid-session","timestamp":"2025-10-06 10:03:19:319"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{"documentType":"W2"},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Session not found\n    at DocumentService.uploadDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\services\\documentService.ts:77:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at uploadDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\documentController.ts:29:24)","statusCode":400,"timestamp":"2025-10-06 10:03:19:319","url":"/api/documents/upload/invalid-session"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/invalid-session HTTP/1.1" 400 161 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/test-session-1759716199532-rvvy5g3du HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:19:319","url":"/api/documents/upload/test-session-1759716199590-r51awwpkj"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/test-session-1759716199590-r51awwpkj HTTP/1.1" 400 514 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[32m[32minfo[32m[39m: [32mDocument uploaded[39m {"documentId":"mgehl9p9_9ffcbff6d5a52606","filename":"test-w2.pdf","sessionId":"test-session-1759716199708-j9dj706gp","size":16,"timestamp":"2025-10-06 10:03:19:319","type":"W2"}
[32m[32minfo[32m[39m: [32mDocument uploaded via API[39m {"clientId":"test-client-123","documentId":"mgehl9p9_9ffcbff6d5a52606","filename":"test-w2.pdf","sessionId":"test-session-1759716199708-j9dj706gp","timestamp":"2025-10-06 10:03:19:319"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:19 +0000] "POST /api/documents/upload/test-session-1759716199708-j9dj706gp HTTP/1.1" 201 522 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:19:319"}
[33m[33mwarn[33m[39m: [33mPDF text extraction not implemented[39m {"filePath":"C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\uploads\\mgehl9p9_9ffcbff6d5a52606.pdf","timestamp":"2025-10-06 10:03:19:319"}
[32m[32minfo[32m[39m: [32mDocument processed successfully[39m {"confidence":0,"documentId":"mgehl9p9_9ffcbff6d5a52606","entitiesCount":0,"textLength":0,"timestamp":"2025-10-06 10:03:19:319"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:20 +0000] "GET /api/documents/mgehl9p9_9ffcbff6d5a52606 HTTP/1.1" 200 618 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:20:320"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:20 +0000] "GET /api/documents/test-document-1759716200922-3tw7ho3z5 HTTP/1.1" 200 579 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:20:320"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents/test-document-1759716201033-hyfoszmz0 HTTP/1.1" 200 579 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents/test-document-1759716201144-l2b0c5q8u HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents/test-document-1759716201246-ml9ord29p HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[31m[31merror[31m[39m: [31mFailed to get document via API[39m {"clientId":"test-client-123","documentId":"507f1f77bcf86cd799439011","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"timestamp":"2025-10-06 10:03:21:321"}
[33m[33mwarn[33m[39m: [33mClient error: Document not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"sessionId":"test-session-1759716201300-oksm0w4wu","stack":"CustomApiError: Document not found\n    at getDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\documentController.ts:85:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:21:321","url":"/api/documents/507f1f77bcf86cd799439011"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents/507f1f77bcf86cd799439011 HTTP/1.1" 404 160 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents?page=1&limit=1 HTTP/1.1" 200 563 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents?documentType=W2 HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:21 +0000] "GET /api/documents?status=processed HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:21:321"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "GET /api/documents HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "GET /api/documents HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[33m[33mwarn[33m[39m: [33mFailed to delete file from disk[39m {"error":{"code":"ENOENT","errno":-4058,"path":"C:\\uploads\\test\\w2-form.pdf","syscall":"unlink"},"path":"/uploads/test/w2-form.pdf","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32mDocument deleted[39m {"documentId":"test-document-1759716202155-ivh72xwef","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32mDocument deleted via API[39m {"clientId":"test-client-123","documentId":"test-document-1759716202155-ivh72xwef","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "DELETE /api/documents/test-document-1759716202155-ivh72xwef HTTP/1.1" 200 58 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[31m[31merror[31m[39m: [31mFailed to get document via API[39m {"clientId":"test-client-123","documentId":"test-document-1759716202155-ivh72xwef","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"timestamp":"2025-10-06 10:03:22:322"}
[33m[33mwarn[33m[39m: [33mClient error: Document not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"sessionId":"test-session-1759716202147-9nt6cd08w","stack":"CustomApiError: Document not found\n    at getDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\documentController.ts:85:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:22:322","url":"/api/documents/test-document-1759716202155-ivh72xwef"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "GET /api/documents/test-document-1759716202155-ivh72xwef HTTP/1.1" 404 173 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "DELETE /api/documents/test-document-1759716202362-tpo7nmwzc HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "DELETE /api/documents/test-document-1759716202482-1gpurbri0 HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[31m[31merror[31m[39m: [31mFailed to delete document via API[39m {"clientId":"test-client-123","documentId":"507f1f77bcf86cd799439011","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"timestamp":"2025-10-06 10:03:22:322"}
[33m[33mwarn[33m[39m: [33mClient error: Document not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"DELETE","query":{},"sessionId":"test-session-1759716202547-zo6mlc6e4","stack":"CustomApiError: Document not found\n    at deleteDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\documentController.ts:386:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:22:322","url":"/api/documents/507f1f77bcf86cd799439011"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "DELETE /api/documents/507f1f77bcf86cd799439011 HTTP/1.1" 404 163 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[33m[33mwarn[33m[39m: [33mPDF text extraction not implemented[39m {"filePath":"/uploads/test/w2-form.pdf","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32mDocument processed successfully[39m {"confidence":0,"documentId":"test-document-1759716202684-3tbkw8533","entitiesCount":0,"textLength":0,"timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32mDocument processing triggered via API[39m {"clientId":"test-client-123","documentId":"test-document-1759716202684-3tbkw8533","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "POST /api/documents/test-document-1759716202684-3tbkw8533/process HTTP/1.1" 200 131 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "POST /api/documents/test-document-1759716202817-445bze3ps/process HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:22 +0000] "POST /api/documents/test-document-1759716202924-jeh3dzh0u/process HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:22:322"}
[31m[31merror[31m[39m: [31mFailed to process document via API[39m {"clientId":"test-client-123","documentId":"507f1f77bcf86cd799439011","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"timestamp":"2025-10-06 10:03:23:323"}
[33m[33mwarn[33m[39m: [33mClient error: Document not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"sessionId":"test-session-1759716202985-2mc1eil1q","stack":"CustomApiError: Document not found\n    at processDocument (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\documentController.ts:434:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:23:323","url":"/api/documents/507f1f77bcf86cd799439011/process"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:23 +0000] "POST /api/documents/507f1f77bcf86cd799439011/process HTTP/1.1" 404 169 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:23 +0000] "GET /api/documents/stats HTTP/1.1" 200 91 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:23 +0000] "GET /api/documents/stats HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:23 +0000] "GET /api/documents/health HTTP/1.1" 200 161 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:23:323"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:24:324"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32mJob created[39m {"jobId":"mgehldhy_e23811cd4924c9b4","priority":"high","sessionId":"test-session-1759716204628-tuf6foeb8","timestamp":"2025-10-06 10:03:24:324","type":"tax_calculation"}
[32m[32minfo[32m[39m: [32mJob created via API[39m {"clientId":"test-client-123","jobId":"mgehldhy_e23811cd4924c9b4","sessionId":"test-session-1759716204628-tuf6foeb8","timestamp":"2025-10-06 10:03:24:324","type":"tax_calculation"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:24 +0000] "POST /api/jobs HTTP/1.1" 201 368 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:24:324"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{"data":{},"type":"invalid_job_type"},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:24:324","url":"/api/jobs"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:24 +0000] "POST /api/jobs HTTP/1.1" 400 246 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:24:324"}
[31m[31merror[31m[39m: [31mFailed to create job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":400},"timestamp":"2025-10-06 10:03:24:324"}
[33m[33mwarn[33m[39m: [33mClient error: Session ID required in X-Session-ID header[39m {"body":{"data":{},"type":"tax_calculation"},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Session ID required in X-Session-ID header\n    at createJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:21:15)\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:124:21\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:21:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:21:3)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:24:324","url":"/api/jobs"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:24 +0000] "POST /api/jobs HTTP/1.1" 400 155 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:24:324"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:24 +0000] "POST /api/jobs HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:24:324"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:25:325","url":"/api/jobs"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "POST /api/jobs HTTP/1.1" 400 219 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[31m[31merror[31m[39m: [31mFailed to update job status[39m {"error":{"filter":{"_id":"68e3236c810515af3c13e79a"},"numAffected":0,"query":{"_id":"68e3236c810515af3c13e79a"},"result":{"$where":{"_id":"68e3236c810515af3c13e79a"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldhy_e23811cd4924c9b4","status":"running","timestamp":"2025-10-06 10:03:25:325"}
[31m[31merror[31m[39m: [31mFailed to start job processing[39m {"error":{"filter":{"_id":"68e3236c810515af3c13e79a"},"numAffected":0,"query":{"_id":"68e3236c810515af3c13e79a"},"result":{"$where":{"_id":"68e3236c810515af3c13e79a"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldhy_e23811cd4924c9b4","timestamp":"2025-10-06 10:03:25:325"}
[31m[31merror[31m[39m: [31mFailed to handle job error[39m {"handlingError":{"filter":{"_id":"68e3236c810515af3c13e79a"},"numAffected":0,"query":{"_id":"68e3236c810515af3c13e79a"},"result":{"$where":{"_id":"68e3236c810515af3c13e79a"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldhy_e23811cd4924c9b4","originalError":{"filter":{"_id":"68e3236c810515af3c13e79a"},"numAffected":0,"query":{"_id":"68e3236c810515af3c13e79a"},"result":{"$where":{"_id":"68e3236c810515af3c13e79a"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32mJob created[39m {"jobId":"mgehldua_507f4c6607d4303e","sessionId":"test-session-1759716205083-6x7nd1vza","timestamp":"2025-10-06 10:03:25:325","type":"document_processing"}
[32m[32minfo[32m[39m: [32mJob created via API[39m {"clientId":"test-client-123","jobId":"mgehldua_507f4c6607d4303e","sessionId":"test-session-1759716205083-6x7nd1vza","timestamp":"2025-10-06 10:03:25:325","type":"document_processing"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "POST /api/jobs HTTP/1.1" 201 371 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/testjobmgehldvv_bc6f91417d3d HTTP/1.1" 200 461 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/testjobmgehldyi_ae10b990d918 HTTP/1.1" 200 461 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/testjobmgehle1i_0c0d73d7495a HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/testjobmgehle41_a0d8c03eb695 HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[31m[31merror[31m[39m: [31mFailed to get job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"jobId":"1234567890_abcdef123456","timestamp":"2025-10-06 10:03:25:325"}
[33m[33mwarn[33m[39m: [33mClient error: Job not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"sessionId":"test-session-1759716205548-y2uiecg2w","stack":"CustomApiError: Job not found\n    at getJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:96:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:25:325","url":"/api/jobs/1234567890_abcdef123456"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/1234567890_abcdef123456 HTTP/1.1" 404 149 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:25:325","url":"/api/jobs/invalid-id"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs/invalid-id HTTP/1.1" 400 258 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs HTTP/1.1" 200 859 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:25 +0000] "GET /api/jobs?page=1&limit=1 HTTP/1.1" 200 464 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:25:325"}
[31m[31merror[31m[39m: [31mFailed to update job status[39m {"error":{"filter":{"_id":"68e3236d810515af3c13e7e5"},"numAffected":0,"query":{"_id":"68e3236d810515af3c13e7e5"},"result":{"$where":{"_id":"68e3236d810515af3c13e7e5"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldua_507f4c6607d4303e","status":"running","timestamp":"2025-10-06 10:03:26:326"}
[31m[31merror[31m[39m: [31mFailed to start job processing[39m {"error":{"filter":{"_id":"68e3236d810515af3c13e7e5"},"numAffected":0,"query":{"_id":"68e3236d810515af3c13e7e5"},"result":{"$where":{"_id":"68e3236d810515af3c13e7e5"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldua_507f4c6607d4303e","timestamp":"2025-10-06 10:03:26:326"}
[31m[31merror[31m[39m: [31mFailed to handle job error[39m {"handlingError":{"filter":{"_id":"68e3236d810515af3c13e7e5"},"numAffected":0,"query":{"_id":"68e3236d810515af3c13e7e5"},"result":{"$where":{"_id":"68e3236d810515af3c13e7e5"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"jobId":"mgehldua_507f4c6607d4303e","originalError":{"filter":{"_id":"68e3236d810515af3c13e7e5"},"numAffected":0,"query":{"_id":"68e3236d810515af3c13e7e5"},"result":{"$where":{"_id":"68e3236d810515af3c13e7e5"},"acknowledged":true,"matchedCount":0,"modifiedCount":0,"upsertedCount":0,"upsertedId":null}},"timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "GET /api/jobs?type=tax_calculation HTTP/1.1" 200 464 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "GET /api/jobs?status=completed HTTP/1.1" 200 464 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "GET /api/jobs?sort=createdAt&order=desc HTTP/1.1" 200 859 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "GET /api/jobs HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "GET /api/jobs HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32mJob status updated[39m {"jobId":"testjobmgehlew7_3814be24f26f","newStatus":"cancelled","oldStatus":"pending","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32mJob cancelled[39m {"jobId":"testjobmgehlew7_3814be24f26f","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32mJob cancelled via API[39m {"clientId":"test-client-123","jobId":"testjobmgehlew7_3814be24f26f","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "POST /api/jobs/testjobmgehlew7_3814be24f26f/cancel HTTP/1.1" 200 165 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[31m[31merror[31m[39m: [31mFailed to cancel job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":400},"jobId":"testjobmgehlezl_c234dce66f12","timestamp":"2025-10-06 10:03:26:326"}
[33m[33mwarn[33m[39m: [33mClient error: Job cannot be cancelled[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"sessionId":"test-session-1759716206618-7ppgn132q","stack":"CustomApiError: Job cannot be cancelled\n    at cancelJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:380:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:26:326","url":"/api/jobs/testjobmgehlezl_c234dce66f12/cancel"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "POST /api/jobs/testjobmgehlezl_c234dce66f12/cancel HTTP/1.1" 400 172 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "POST /api/jobs/testjobmgehlf2t_bb02d22adb15/cancel HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "POST /api/jobs/testjobmgehlf53_1f66582dcf7f/cancel HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[31m[31merror[31m[39m: [31mFailed to cancel job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"jobId":"1234567890_abcdef123456","timestamp":"2025-10-06 10:03:26:326"}
[33m[33mwarn[33m[39m: [33mClient error: Job not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"POST","query":{},"sessionId":"test-session-1759716206870-n4nv0f17f","stack":"CustomApiError: Job not found\n    at cancelJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:369:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:26:326","url":"/api/jobs/1234567890_abcdef123456/cancel"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:26 +0000] "POST /api/jobs/1234567890_abcdef123456/cancel HTTP/1.1" 404 157 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:26:326"}
[32m[32minfo[32m[39m: [32mJob deleted[39m {"deletedCount":1,"jobId":"testjobmgehlf9h_f5f63248e976","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mJob deleted via API[39m {"clientId":"test-client-123","jobId":"testjobmgehlf9h_f5f63248e976","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "DELETE /api/jobs/testjobmgehlf9h_f5f63248e976 HTTP/1.1" 200 140 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[31m[31merror[31m[39m: [31mFailed to get job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"jobId":"testjobmgehlf9h_f5f63248e976","timestamp":"2025-10-06 10:03:27:327"}
[33m[33mwarn[33m[39m: [33mClient error: Job not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"sessionId":"test-session-1759716206968-95omjnq2l","stack":"CustomApiError: Job not found\n    at getJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:96:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:27:327","url":"/api/jobs/testjobmgehlf9h_f5f63248e976"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "GET /api/jobs/testjobmgehlf9h_f5f63248e976 HTTP/1.1" 404 154 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "DELETE /api/jobs/testjobmgehlfdt_9223b6ae1656 HTTP/1.1" 400 60 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "DELETE /api/jobs/testjobmgehlfg0_055c74357e81 HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[31m[31merror[31m[39m: [31mFailed to delete job via API[39m {"clientId":"test-client-123","error":{"code":"INTERNAL_ERROR","name":"CustomApiError","statusCode":404},"jobId":"1234567890_abcdef123456","timestamp":"2025-10-06 10:03:27:327"}
[33m[33mwarn[33m[39m: [33mClient error: Job not found[39m {"body":{},"clientId":"test-client-123","code":"INTERNAL_ERROR","ip":"::ffff:127.0.0.1","method":"DELETE","query":{},"sessionId":"test-session-1759716207268-q9aye7ndp","stack":"CustomApiError: Job not found\n    at deleteJob (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\jobController.ts:699:15)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:27:327","url":"/api/jobs/1234567890_abcdef123456"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "DELETE /api/jobs/1234567890_abcdef123456 HTTP/1.1" 404 152 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "GET /api/jobs/stats HTTP/1.1" 200 186 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "GET /api/jobs/stats HTTP/1.1" 200 186 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "GET /api/jobs/stats HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleanup via API[39m {"clientId":"test-client-123","deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "POST /api/jobs/cleanup HTTP/1.1" 200 91 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "POST /api/jobs/cleanup HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:27 +0000] "GET /api/jobs/health HTTP/1.1" 200 206 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:27:327"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:28:328"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:28:328"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mCreating new session[39m {"clientId":"test-client-123","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession created[39m {"clientId":"test-client-123","expiresAt":"2025-10-06T03:03:29.211Z","sessionId":"mgehlgzf_b5941601478e5561","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "POST /api/sessions HTTP/1.1" 201 382 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "POST /api/sessions HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mCreating new session[39m {"clientId":"test-client-123","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession created[39m {"clientId":"test-client-123","expiresAt":"2025-10-06T03:03:29.341Z","sessionId":"mgehlh31_247bb1b134a83045","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "POST /api/sessions HTTP/1.1" 201 382 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mCreating new session[39m {"clientId":"test-client-123","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mSession created[39m {"clientId":"test-client-123","expiresAt":"2025-10-06T03:03:29.433Z","sessionId":"mgehlh5l_1e7c4040befbeacf","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "POST /api/sessions HTTP/1.1" 201 382 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mCreating new session[39m {"clientId":"test-client-123","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mReturning existing session[39m {"clientId":"test-client-123","sessionId":"mgehlh5l_1e7c4040befbeacf","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "POST /api/sessions HTTP/1.1" 200 347 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "GET /api/sessions/test-session-1759716209533-10hu48e0n HTTP/1.1" 200 613 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "GET /api/sessions/test-session-1759716209605-i6baa95xf HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\sessionController.ts:46:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:29:329","url":"/api/sessions/non-existent-session"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "GET /api/sessions/non-existent-session HTTP/1.1" 404 157 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[33m[33mwarn[33m[39m: [33mClient error: Validation failed[39m {"body":{},"clientId":"test-client-123","code":"VALIDATION_ERROR","ip":"::ffff:127.0.0.1","method":"GET","query":{},"stack":"CustomApiError: Validation failed\n    at validationErrorHandler (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\errorHandler.ts:139:10)\n    at handleValidationErrors (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\middleware\\validation.ts:17:51)\n    at Layer.handle [as handle_request] (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at middleware (C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\node_modules\\express-validator\\lib\\middlewares\\check.js:16:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":400,"timestamp":"2025-10-06 10:03:29:329","url":"/api/sessions/invalid-format"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "GET /api/sessions/invalid-format HTTP/1.1" 400 278 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mUpdating session[39m {"sessionId":"test-session-1759716209822-ab46twd5k","timestamp":"2025-10-06 10:03:29:329","updates":["metadata"]}
[32m[32minfo[32m[39m: [32mSession updated[39m {"sessionId":"test-session-1759716209822-ab46twd5k","timestamp":"2025-10-06 10:03:29:329","updates":["metadata"]}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "PUT /api/sessions/test-session-1759716209822-ab46twd5k HTTP/1.1" 200 250 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32mUpdating session[39m {"sessionId":"test-session-1759716209917-wb9zez7mm","timestamp":"2025-10-06 10:03:29:329","updates":["metadata"]}
[32m[32minfo[32m[39m: [32mSession updated[39m {"sessionId":"test-session-1759716209917-wb9zez7mm","timestamp":"2025-10-06 10:03:29:329","updates":["metadata"]}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:29 +0000] "PUT /api/sessions/test-session-1759716209917-wb9zez7mm HTTP/1.1" 200 165 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:29:329"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "PUT /api/sessions/test-session-1759716210014-vur24nvwn HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mUpdating session[39m {"sessionId":"non-existent-session","timestamp":"2025-10-06 10:03:30:330","updates":["metadata"]}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{"metadata":{}},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"PUT","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\sessionController.ts:87:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:30:330","url":"/api/sessions/non-existent-session"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "PUT /api/sessions/non-existent-session HTTP/1.1" 404 157 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mDeactivating session[39m {"sessionId":"test-session-1759716210148-0s5rp9dvz","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mSession deactivated[39m {"modified":true,"sessionId":"test-session-1759716210148-0s5rp9dvz","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "DELETE /api/sessions/test-session-1759716210148-0s5rp9dvz HTTP/1.1" 200 61 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "GET /api/sessions/test-session-1759716210148-0s5rp9dvz HTTP/1.1" 200 616 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "DELETE /api/sessions/test-session-1759716210273-sus7088js HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mDeactivating session[39m {"sessionId":"non-existent-session","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mSession deactivated[39m {"modified":false,"sessionId":"non-existent-session","timestamp":"2025-10-06 10:03:30:330"}
[33m[33mwarn[33m[39m: [33mClient error: Session not found[39m {"body":{},"clientId":"test-client-123","code":"SESSION_NOT_FOUND","ip":"::ffff:127.0.0.1","method":"DELETE","query":{},"stack":"CustomApiError: Session not found\n    at C:\\Users\\jiale\\OneDrive\\Documents\\Chat-engine\\src\\controllers\\sessionController.ts:111:13\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":404,"timestamp":"2025-10-06 10:03:30:330","url":"/api/sessions/non-existent-session"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "DELETE /api/sessions/non-existent-session HTTP/1.1" 404 160 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "GET /api/sessions/client/test-client-1759716210414 HTTP/1.1" 200 628 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "GET /api/sessions/client/test-client-1759716210489 HTTP/1.1" 401 142 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "GET /api/sessions/client/non-existent-client HTTP/1.1" 200 2 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:30 +0000] "GET /api/sessions/health HTTP/1.1" 200 212 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:30:330"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mSSE service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mInitializing Chat Engine Tax Filing API...[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mConnecting to database...[39m {"timestamp":"2025-10-06 10:03:31:331"}
[33m[33mwarn[33m[39m: [33mDatabase already connected[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mDatabase connected successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mInitializing services...[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mClient service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mSession cache warmed up[39m {"count":0,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mExpired sessions cleaned up[39m {"count":0,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mSession service initialized successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mSession service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mOld conversations archived[39m {"count":0,"olderThanDays":30,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mConversation service initialized successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mConversation service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mOld documents cleaned up[39m {"deletedCount":0,"olderThanDays":90,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mDocument service initialized successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mDocument service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mCompleted jobs cleaned up[39m {"deletedCount":0,"olderThanDays":7,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mJob service initialized successfully[39m {"pendingJobs":0,"queueSize":0,"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mJob service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mTax form service initialized successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mTax form service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized in test mode (mocked responses)[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mOpenAI service initialized[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mJob processing started[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32mAll services initialized successfully[39m {"timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:31 +0000] "GET /health HTTP/1.1" 200 97 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:31 +0000] "GET /api/health HTTP/1.1" 200 595 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:31:331"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:32 +0000] "GET /api/health HTTP/1.1" 200 595 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:32 +0000] "GET /api/health/detailed HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:32 +0000] "GET /api/health/detailed HTTP/1.1" 200 - "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:32 +0000] "GET / HTTP/1.1" 200 210 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32m::ffff:127.0.0.1 - - [06/Oct/2025:02:03:32 +0000] "GET /api HTTP/1.1" 200 537 "-" "-"[39m {"source":"http","timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32mSSE service shutdown[39m {"timestamp":"2025-10-06 10:03:32:332"}
[32m[32minfo[32m[39m: [32mJob processing stopped[39m {"timestamp":"2025-10-06 10:03:32:332"}
