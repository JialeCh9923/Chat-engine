<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Engine Tax Filing Portal</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-calculator"></i>
                    <h1>TaxFiling AI Portal</h1>
                </div>
                <div class="header-actions">
                    <div class="api-key-status" id="apiKeyStatus">
                        <span class="status-indicator offline"></span>
                        <span>Not Connected</span>
                    </div>
                    <button class="btn btn-primary" id="connectBtn">
                        <i class="fas fa-plug"></i>
                        Connect API
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-sidebar" id="navSidebar">
        <div class="nav-content">
            <ul class="nav-menu">
                <li class="nav-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-section="sessions">
                    <i class="fas fa-folder-open"></i>
                    <span>Sessions</span>
                </li>
                <li class="nav-item" data-section="conversations">
                    <i class="fas fa-comments"></i>
                    <span>Conversations</span>
                </li>
                <li class="nav-item" data-section="documents">
                    <i class="fas fa-file-upload"></i>
                    <span>Documents</span>
                </li>
                <li class="nav-item" data-section="tax-forms">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Tax Forms</span>
                </li>
                <li class="nav-item" data-section="jobs">
                    <i class="fas fa-tasks"></i>
                    <span>Jobs</span>
                </li>
                <li class="nav-item" data-section="real-time">
                    <i class="fas fa-broadcast-tower"></i>
                    <span>Real-time</span>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard Section -->
        <section class="content-section active" id="dashboard">
            <div class="container">
                <div class="section-header">
                    <h2>Dashboard</h2>
                    <p>Overview of your tax filing activities</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon sessions">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalSessions">0</h3>
                            <p>Total Sessions</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon conversations">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalConversations">0</h3>
                            <p>Conversations</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon documents">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalDocuments">0</h3>
                            <p>Documents</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon jobs">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalJobs">0</h3>
                            <p>Jobs</p>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Session Status</h3>
                        <canvas id="sessionChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Job Queue Status</h3>
                        <canvas id="jobChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sessions Section -->
        <section class="content-section" id="sessions">
            <div class="container">
                <div class="section-header">
                    <h2>Tax Filing Sessions</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" id="createSessionBtn">
                            <i class="fas fa-plus"></i>
                            Create Session
                        </button>
                    </div>
                </div>

                <div class="sessions-controls">
                    <div class="search-filter">
                        <input type="text" id="sessionSearch" placeholder="Search sessions...">
                        <select id="sessionFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>
                </div>

                <div class="sessions-grid" id="sessionsGrid">
                    <!-- Sessions will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Conversations Section -->
        <section class="content-section" id="conversations">
            <div class="container">
                <div class="section-header">
                    <h2>AI Tax Conversations</h2>
                    <div class="section-actions">
                        <select id="conversationSessionSelect">
                            <option value="">Select Session</option>
                        </select>
                        <button class="btn btn-primary" id="createConversationBtn">
                            <i class="fas fa-plus"></i>
                            New Conversation
                        </button>
                    </div>
                </div>

                <div class="conversations-layout">
                    <div class="conversations-list" id="conversationsList">
                        <!-- Conversations will be loaded here -->
                    </div>
                    <div class="chat-container" id="chatContainer">
                        <div class="chat-empty-state">
                            <i class="fas fa-comments"></i>
                            <h3>Select a conversation to start chatting</h3>
                            <p>Or create a new conversation to get AI tax assistance</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Documents Section -->
        <section class="content-section" id="documents">
            <div class="container">
                <div class="section-header">
                    <h2>Document Management</h2>
                    <div class="section-actions">
                        <select id="documentSessionSelect">
                            <option value="">Select Session</option>
                        </select>
                    </div>
                </div>

                <div class="upload-zone" id="uploadZone">
                    <div class="upload-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Drag & Drop Files Here</h3>
                        <p>or click to browse files</p>
                        <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png,.txt,.doc,.docx">
                    </div>
                </div>

                <div class="documents-list" id="documentsList">
                    <!-- Documents will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Tax Forms Section -->
        <section class="content-section" id="tax-forms">
            <div class="container">
                <div class="section-header">
                    <h2>Tax Forms</h2>
                    <div class="section-actions">
                        <select id="taxFormSessionSelect">
                            <option value="">Select Session</option>
                        </select>
                        <button class="btn btn-primary" id="createTaxFormBtn">
                            <i class="fas fa-plus"></i>
                            Create Form
                        </button>
                    </div>
                </div>

                <div class="tax-forms-grid" id="taxFormsGrid">
                    <!-- Tax forms will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Jobs Section -->
        <section class="content-section" id="jobs">
            <div class="container">
                <div class="section-header">
                    <h2>Job Queue</h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary" id="refreshJobsBtn">
                            <i class="fas fa-sync"></i>
                            Refresh
                        </button>
                    </div>
                </div>

                <div class="jobs-list" id="jobsList">
                    <!-- Jobs will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Real-time Section -->
        <section class="content-section" id="real-time">
            <div class="container">
                <div class="section-header">
                    <h2>Real-time Updates</h2>
                    <div class="section-actions">
                        <button class="btn btn-success" id="connectSSEBtn">
                            <i class="fas fa-wifi"></i>
                            Connect
                        </button>
                        <button class="btn btn-danger" id="disconnectSSEBtn" disabled>
                            <i class="fas fa-stop"></i>
                            Disconnect
                        </button>
                    </div>
                </div>

                <div class="real-time-status" id="realTimeStatus">
                    <div class="status-indicator offline"></div>
                    <span>Disconnected from real-time updates</span>
                </div>

                <div class="events-log" id="eventsLog">
                    <!-- Real-time events will appear here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div class="modal" id="apiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connect to API</h3>
                <button class="modal-close" id="closeApiKeyModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="apiKeyInput">API Key</label>
                    <input type="password" id="apiKeyInput" placeholder="Enter your API key">
                    <small>Your API key will be stored locally in your browser</small>
                </div>
                <div class="form-group">
                    <label for="apiUrlInput">API URL</label>
                    <input type="url" id="apiUrlInput" placeholder="http://localhost:3000/api" value="http://localhost:3000/api">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelApiKey">Cancel</button>
                <button class="btn btn-primary" id="saveApiKey">Connect</button>
            </div>
        </div>
    </div>

    <div class="modal" id="createSessionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Session</h3>
                <button class="modal-close" id="closeSessionModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="sessionTitle">Session Title</label>
                    <input type="text" id="sessionTitle" placeholder="e.g., John Doe Tax Filing 2024">
                </div>
                <div class="form-group">
                    <label for="filingType">Filing Type</label>
                    <select id="filingType">
                        <option value="individual">Individual</option>
                        <option value="business">Business</option>
                        <option value="nonprofit">Non-Profit</option>
                        <option value="estate">Estate</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taxYear">Tax Year</label>
                    <input type="number" id="taxYear" value="2024" min="2020" max="2025">
                </div>
                <div class="form-group">
                    <label for="sessionMetadata">Additional Info (JSON)</label>
                    <textarea id="sessionMetadata" placeholder='{"clientName": "John Doe", "ssn": "XXX-XX-XXXX"}'></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSession">Cancel</button>
                <button class="btn btn-primary" id="createSession">Create Session</button>
            </div>
        </div>
    </div>

    <div class="modal" id="createTaxFormModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Tax Form</h3>
                <button class="modal-close" id="closeTaxFormModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="formType">Form Type</label>
                    <select id="formType">
                        <option value="1040">Form 1040</option>
                        <option value="1040ez">Form 1040EZ</option>
                        <option value="schedule_a">Schedule A</option>
                        <option value="schedule_c">Schedule C</option>
                        <option value="w2">W-2</option>
                        <option value="1099">1099</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="formYear">Tax Year</label>
                    <input type="number" id="formYear" value="2024" min="2020" max="2025">
                </div>
                <div class="form-group">
                    <label for="formData">Initial Data (JSON)</label>
                    <textarea id="formData" placeholder='{"income": 50000, "deductions": []}'></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelTaxForm">Cancel</button>
                <button class="btn btn-primary" id="createTaxForm">Create Form</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="api-client.js"></script>
    <script src="app.js"></script>
</body>
</html>